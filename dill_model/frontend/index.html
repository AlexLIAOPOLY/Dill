<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title">多模型光刻胶计算工具</title>
    <!-- 引入Google字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="css/style.css?v=1.1">
    <link rel="stylesheet" href="css/animations.css?v=1.1">
    <link rel="stylesheet" href="css/popup-enhanced.css?v=1.0">
    <link rel="stylesheet" href="css/car-model.css?v=1.0">
    <link rel="stylesheet" href="css/loading-animation.css">
    <!-- 引入Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.25.2.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- 加载动画 -->
    <div id="loading" class="loading">
        <div class="loader-container">
            <!-- 多层旋转环 -->
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            
            <!-- 中心圆点 -->
            <div class="spinner-core"></div>
            
            <!-- 波浪效果 -->
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
            
            <!-- 粒子效果 -->
            <div class="particles">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>
            
            <!-- 分子路径 -->
            <div class="molecule-path">
                <div class="path"><div class="molecule"></div></div>
                <div class="path"><div class="molecule"></div></div>
                <div class="path"><div class="molecule"></div></div>
                <div class="path"><div class="molecule"></div></div>
            </div>
        </div>
        <div class="loading-text" data-i18n="loading">加载中...</div>
    </div>
    
    <!-- 页头 -->
    <header>
        <div class="header-content">
            <div class="logo" data-i18n="logo"><span>多模型</span>计算工具</div>
            <nav class="main-nav">
                <ul>
                    <li class="active"><a href="index.html" data-i18n="nav_single">单一计算</a></li>
                    <li><a href="compare.html" data-i18n="nav_compare">参数比较</a></li>
                </ul>
            </nav>
            <div class="lang-switcher">
                <button id="lang-toggle-btn" data-i18n="lang_btn">English/中文</button>
            </div>
        </div>
    </header>
    
    <!-- 主要内容 -->
    <main class="main-content">
        <div class="container">
            <!-- 错误消息 -->
            <div id="error-message" class="error-message" data-i18n="error_message"></div>

            <!-- 模型选择与公式展示区域 -->
            <section id="model-selection-section" class="model-selection-section">
                <h2 class="section-title">模型选择与说明</h2>
                <div class="model-selector-container">
                    <label for="model-select" class="model-select-label" data-i18n="select_model">选择计算模型:</label>
                    <select id="model-select" class="model-select">
                        <option value="dill" selected data-i18n="dill_model">Dill模型（薄胶）</option>
                        <option value="enhanced_dill" data-i18n="enhanced_dill_model">增强Dill模型（厚胶）</option>
                        <option value="car" data-i18n="car_model">CAR模型（化学放大型光刻胶）</option>
                    </select>
                </div>

                <div id="model-description-container" class="model-description-container">
                    <div id="dill-desc" style="display:block;">
                        <h3 class="model-description-title" data-i18n="dill_formula_title">Dill模型</h3>
                        <div class="model-core-formula" data-i18n="dill_formula_core">核心关系: <code>M(x,z) = exp(-C · D(x,z))</code></div>
                        <p class="formula-notation" data-i18n="dill_formula_note"><em>M: 归一化光敏剂浓度, C: 光敏速率常数, D: 曝光剂量</em></p>
                        <div class="model-math"></div>
                        <div class="model-ref"></div>
                        <button id="dill-toggle-details" class="toggle-details-btn" data-i18n="btn_expand">展开更多 <i class="fas fa-chevron-down"></i></button>
                        <div id="dill-full-details" class="model-full-details" style="margin-bottom:0;padding-bottom:0;">
                            <h4 data-i18n="dill_formula_ode">微分方程</h4>
                            <code style="display:block;margin-bottom:10px;" data-i18n="dill_formula_ode_code">∂M/∂t = -C·I·M</code>
                            <div style="color:#34495e;font-size:0.98rem;margin-bottom:12px;" data-i18n="dill_formula_ref">参考：Dill F H, Neureuther A R, Tuttle J A, et al. IEEE Trans Electron Devices, 1975.</div>
                            <h4 data-i18n="dill_formula_scope">Dill模型主要适用于薄胶层（< 3μm）的光刻胶曝光过程建模，其中光的穿透性较好，光强分布较为均匀。</h4>
                            <h4 data-i18n="dill_formula_math">完整的Dill模型包括三个关键参数A、B、C：</h4>
                            <ul>
                                <li data-i18n="dill_formula_math_A"><b>参数A</b>：表示光敏剂对光的吸收率</li>
                                <li data-i18n="dill_formula_math_B"><b>参数B</b>：表示基底对光的吸收率</li>
                                <li data-i18n="dill_formula_math_C"><b>参数C</b>：表示光敏剂对光的反应速率</li>
                            </ul>
                            <p data-i18n="dill_formula_simple">在本工具的简化模型中，主要使用参数C来表征光刻胶的曝光特性。</p>
                            <h4 data-i18n="dill_formula_detail">核心公式详解</h4>
                            <div class="formula-details-card inner-formula-card">
                                <div class="formula-card-body">
                                    <div class="formula-large" data-i18n="dill_formula_core"><code>M(x,z) = exp(-C · D(x,z))</code></div>
                                    <div class="formula-description">
                                        <div class="formula-param" data-i18n="dill_formula_param_M"><span class="param-name">M(x,z):</span> <span class="param-desc">位置(x,z)处的归一化光敏剂浓度，M=1表示未曝光区域，M=0表示完全曝光区域</span></div>
                                        <div class="formula-param" data-i18n="dill_formula_param_C"><span class="param-name">C:</span> <span class="param-desc">光敏速率常数，表示光刻胶对光的敏感程度，单位: cm²/mJ</span></div>
                                        <div class="formula-param" data-i18n="dill_formula_param_D"><span class="param-name">D(x,z):</span> <span class="param-desc">位置(x,z)处的曝光剂量，单位: mJ/cm²</span></div>
                                    </div>
                                    <div class="formula-derivation">
                                        <h4 data-i18n="dill_formula_ode2">微分方程形式</h4>
                                        <code data-i18n="dill_formula_ode2_code">∂M/∂t = -C · I · M</code>
                                        <p data-i18n="dill_formula_ode2_note">其中I为光强度，表示单位时间内的曝光剂量。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="enhanced-dill-desc" style="display:none;">
                        <h3 class="model-description-title" data-i18n="enhanced_formula_title">增强Dill模型（厚胶）</h3>
                        <div class="model-core-formula" data-i18n="enhanced_formula_core">核心关系: <code>∂I/∂z = -I·[A(z_h,T,t_B)·M+B(z_h,T,t_B)]</code></div>
                        <p data-i18n="enhanced_formula_core2"><code>∂M/∂t = -I·M·C(z_h,T,t_B)</code></p>
                        <div class="model-math"></div>
                        <div class="model-ref"></div>
                        <button id="enhanced-dill-toggle-details" class="toggle-details-btn" data-i18n="btn_expand">展开更多 <i class="fas fa-chevron-down"></i></button>
                        <div id="enhanced-dill-full-details" class="model-full-details" style="margin-bottom:0;padding-bottom:0;">
                            <h4 data-i18n="enhanced_formula_ode">微分方程</h4>
                            <code style="display:block;margin-bottom:10px;" data-i18n="enhanced_formula_ode_code">∂I/∂z = -I·[A(z_h,T,t_B)·M+B(z_h,T,t_B)]<br>∂M/∂t = -I·M·C(z_h,T,t_B)</code>
                            <div style="color:#34495e;font-size:0.98rem;margin-bottom:12px;" data-i18n="enhanced_formula_ref">参考：刘世杰等《厚层抗蚀剂曝光模型及其参数测量》, 2005.</div>
                            <h4 data-i18n="enhanced_formula_scope">该模型特别适用于厚胶层（> 5μm）光刻胶，其中光的穿透性受到明显影响，光强随深度衰减较为显著。</h4>
                            <h4 data-i18n="enhanced_formula_fit">参数拟合</h4>
                            <p data-i18n="enhanced_formula_fit_math">根据刘世杰等的研究，A/B/C参数可以通过以下形式表示：</p>
                            <ul>
                                <li data-i18n="enhanced_formula_fit_A">A(z_h,T,t_B) = a₀ + a₁·z_h + a₂·T + a₃·z_h² + a₄·z_h·T + a₅·T²</li>
                                <li data-i18n="enhanced_formula_fit_B">B(z_h,T,t_B) = b₀ + b₁·z_h + b₂·T</li>
                                <li data-i18n="enhanced_formula_fit_C">C(z_h,T,t_B) = c₀ + c₁·z_h + c₂·T + c₃·z_h²</li>
                            </ul>
                            <p data-i18n="enhanced_formula_fit_note">其中参数a₀~a₅, b₀~b₂, c₀~c₃由实验数据拟合得到。</p>
                            <h4 data-i18n="enhanced_formula_detail">核心公式详解</h4>
                            <div class="formula-details-card inner-formula-card">
                                <div class="formula-card-body">
                                    <div class="formula-large" data-i18n="enhanced_formula_core">∂I/∂z = -I·[A(z_h,T,t_B)·M+B(z_h,T,t_B)]</div>
                                    <div class="formula-large" data-i18n="enhanced_formula_core2"><code>∂M/∂t = -I·M·C(z_h,T,t_B)</code></div>
                                    <div class="formula-description">
                                        <div class="formula-param" data-i18n="enhanced_formula_param_I"><span class="param-name">I:</span> <span class="param-desc">光强度，随深度z变化</span></div>
                                        <div class="formula-param" data-i18n="enhanced_formula_param_M"><span class="param-name">M:</span> <span class="param-desc">归一化光敏剂浓度</span></div>
                                        <div class="formula-param" data-i18n="enhanced_formula_param_A"><span class="param-name">A(z_h,T,t_B):</span> <span class="param-desc">光敏剂吸收率，与胶厚、前烘温度、前烘时间相关</span></div>
                                        <div class="formula-param" data-i18n="enhanced_formula_param_B"><span class="param-name">B(z_h,T,t_B):</span> <span class="param-desc">基底吸收率，与胶厚、前烘温度、前烘时间相关</span></div>
                                        <div class="formula-param" data-i18n="enhanced_formula_param_C"><span class="param-name">C(z_h,T,t_B):</span> <span class="param-desc">光敏速率常数，与胶厚、前烘温度、前烘时间相关</span></div>
                                    </div>
                                    <div class="formula-derivation">
                                        <h4 data-i18n="enhanced_formula_fit_detail">参数拟合公式</h4>
                                        <p data-i18n="enhanced_formula_fit_desc">A、B、C参数通过多项式函数拟合实验数据：</p>
                                        <code data-i18n="enhanced_formula_fit_A">A(z_h,T,t_B) = a₀ + a₁·z_h + a₂·T + a₃·z_h² + a₄·z_h·T + a₅·T²</code><br>
                                        <code data-i18n="enhanced_formula_fit_B">B(z_h,T,t_B) = b₀ + b₁·z_h + b₂·T</code><br>
                                        <code data-i18n="enhanced_formula_fit_C">C(z_h,T,t_B) = c₀ + c₁·z_h + c₂·T + c₃·z_h²</code>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="car-desc" style="display:none;">
                        <h3 class="model-description-title" data-i18n="car_formula_title">CAR模型（化学放大型光刻胶）</h3>
                        <div class="model-core-formula" data-i18n="car_formula_core">核心过程: 光酸生成 → 扩散 → 催化反应 → 显影</div>
                        <p class="formula-notation" data-i18n="car_formula_note"><em>CAR: 化学放大型光刻胶 (Chemically Amplified Resist)</em></p>
                        <div class="model-math"></div>
                        <div class="model-ref"></div>
                        <button id="car-toggle-details" class="toggle-details-btn" data-i18n="btn_expand">展开更多 <i class="fas fa-chevron-down"></i></button>
                        <div id="car-full-details" class="model-full-details" style="margin-bottom:0;padding-bottom:0;">
                            <h4 data-i18n="car_formula_ode">关键方程</h4>
                            <code style="display:block;margin-bottom:10px;" data-i18n="car_formula_ode_code">[H⁺] = η·D(x)<br>D(x,t) = I(x)·t<br>扩散: [H⁺]_diff = G([H⁺], l_diff)<br>脱保护度: M = 1-exp(-k·[H⁺]_diff·A)</code>
                            <div style="color:#34495e;font-size:0.98rem;margin-bottom:12px;" data-i18n="car_formula_ref">参考：Hinsberg et al., "Chemical amplification mechanism", Proc. SPIE, 1994.</div>
                            <h4 data-i18n="car_formula_scope">该模型特别适用于DUV (深紫外)光刻胶，其中一个光子可以通过光酸催化机制引发多次化学反应。</h4>
                            <h4 data-i18n="car_formula_math">CAR模型的四个关键步骤：</h4>
                            <ul>
                                <li data-i18n="car_formula_math_A"><b>光酸生成</b>：曝光产生初始光酸分布，与曝光剂量和量子效率有关</li>
                                <li data-i18n="car_formula_math_B"><b>光酸扩散</b>：后烘过程中光酸分子扩散，使空间分布变得平滑</li>
                                <li data-i18n="car_formula_math_C"><b>催化反应</b>：每个光酸分子可催化多个保护基团脱离，实现化学放大</li>
                                <li data-i18n="car_formula_math_D"><b>显影过程</b>：脱保护区域可被显影液溶解，形成图案</li>
                            </ul>
                            <p data-i18n="car_formula_simple">本模型关注放大效应、对比度和分辨率之间的关系。</p>
                            <h4 data-i18n="car_formula_detail">核心公式详解</h4>
                            <div class="formula-details-card inner-formula-card">
                                <div class="formula-card-body">
                                    <div class="formula-large" data-i18n="car_formula_acid"><code>[H⁺] = η·D(x) = η·I(x)·t_exp</code></div>
                                    <div class="formula-large" data-i18n="car_formula_deprotect"><code>M = 1-exp(-k·[H⁺]_diff·A)</code></div>
                                    <div class="formula-description">
                                        <div class="formula-param" data-i18n="car_formula_param_H"><span class="param-name">[H⁺]:</span> <span class="param-desc">光酸浓度，与曝光剂量成正比</span></div>
                                        <div class="formula-param" data-i18n="car_formula_param_eta"><span class="param-name">η:</span> <span class="param-desc">光酸产生效率，反映光子到光酸分子的转化效率</span></div>
                                        <div class="formula-param" data-i18n="car_formula_param_diff"><span class="param-name">[H⁺]_diff:</span> <span class="param-desc">经过扩散后的光酸浓度分布</span></div>
                                        <div class="formula-param" data-i18n="car_formula_param_k"><span class="param-name">k:</span> <span class="param-desc">反应速率常数，表征催化反应效率</span></div>
                                        <div class="formula-param" data-i18n="car_formula_param_A"><span class="param-name">A:</span> <span class="param-desc">放大因子，表示每个光酸分子可以催化的反应数量</span></div>
                                        <div class="formula-param" data-i18n="car_formula_param_M"><span class="param-name">M:</span> <span class="param-desc">树脂脱保护程度，影响显影后的溶解速率</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 参数输入区域 -->
            <section class="parameters-section">
                <h2 class="section-title">参数设置</h2>
                
                <div id="dill-params" class="parameters-grid" style="display:block;">
                    <!-- 参数1: I_avg -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">平均入射光强度 (I<sub>avg</sub>)</span>
                            
                            <span class="parameter-value">10</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="I_avg" class="slider" min="1" max="100" step="0.1" value="10">
                            <input type="number" class="number-input" value="10" min="1" max="100" step="0.1">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_I_avg">平均入射光强度，单位：mW/cm²</div>
                    </div>
                    
                    <!-- 参数2: V -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">干涉条纹可见度 (V)</span>
                            
                            <span class="parameter-value">0.8</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="V" class="slider" min="0" max="1" step="0.01" value="0.8">
                            <input type="number" class="number-input" value="0.8" min="0" max="1" step="0.01">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_V">干涉条纹的对比度，范围：0-1</div>
                    </div>
                    
                    <!-- 参数3: K -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">空间频率 (K)</span>
                            
                            <span class="parameter-value">2</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="K" class="slider" min="0.1" max="10" step="0.1" value="2">
                            <input type="number" class="number-input" value="2" min="0.1" max="10" step="0.1">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_K">干涉条纹的空间频率，单位：rad/μm</div>
                    </div>
                    
                    <!-- 参数4: t_exp -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">曝光时间 (t<sub>exp</sub>)</span>
                            
                            <span class="parameter-value">5</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="t_exp" class="slider" min="0.1" max="20" step="0.1" value="5">
                            <input type="number" class="number-input" value="5" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_t_exp">总曝光时间，单位：秒</div>
                    </div>
                    
                    <!-- 参数5: C -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">光敏速率常数 (C)</span>
                            
                            <span class="parameter-value">0.02</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="C" class="slider" min="0.001" max="0.1" step="0.001" value="0.02">
                            <input type="number" class="number-input" value="0.02" min="0.001" max="0.1" step="0.001">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_C">光刻胶的Dill C参数，单位：cm²/mJ</div>
                    </div>

                    <!-- 在Dill参数区顶部插入正弦波类型选择和多维参数输入区 -->
                    <div class="parameter-item" id="dill-sine-type-container">
                        <label for="dill-sine-type" data-i18n="sine_wave_type_label">正弦波类型：</label>
                        <select id="dill-sine-type" class="model-select">
                            <option value="single" selected data-i18n="sine_wave_type_single">一维正弦波</option>
                            <option value="multi" data-i18n="sine_wave_type_multi">二维正弦波</option>
                        </select>
                    </div>
                    <div id="dill-multisine-params" style="display:none;">
                        <div class="parameter-item slider-fill">
                            <div class="parameter-label"><span class="parameter-name" data-i18n="kx_label">Kx (空间频率x)</span></div>
                            <div class="parameter-input"><input type="number" id="Kx" value="2" min="0.1" max="10" step="0.1"></div>
                            <div class="parameter-description" data-i18n="kx_description">x方向空间频率，单位：rad/μm，范围：0.1~10</div>
                        </div>
                        <div class="parameter-item slider-fill">
                            <div class="parameter-label"><span class="parameter-name" data-i18n="ky_label">Ky (空间频率y)</span></div>
                            <div class="parameter-input"><input type="number" id="Ky" value="1" min="0.1" max="100" step="0.1"></div>
                            <div class="parameter-description" data-i18n="ky_description">y方向空间频率，单位：rad/μm，范围：0.1~100（必须大于0）</div>
                        </div>
                        <div class="parameter-item slider-fill">
                            <div class="parameter-label"><span class="parameter-name" data-i18n="phi_label">φ(t) (相位表达式)</span></div>
                            <div class="parameter-input"><input type="text" id="phi_expr" value="0"></div>
                            <div class="phi-expr-error" style="color:#d00;font-size:0.95em;display:none;"></div>
                            <button id="phi-expr-preview-btn" style="margin-top:4px;display:none;">预览分布</button>
                            <div id="phi-expr-preview-plot" style="margin-top:8px;display:none;"></div>
                        </div>
                    </div>

                    <!-- y范围输入区，插入到参数区合适位置 -->
                    <div class="parameter-item" id="y-range-container">
                        <label data-i18n="y_range_label">y范围 (μm)：</label>
                        <input type="number" id="y_min" value="0" min="0" max="100" step="0.1"> ~
                        <input type="number" id="y_max" value="10" min="0" max="100" step="0.1">
                        <label data-i18n="y_resolution_label">分辨率：</label>
                        <input type="number" id="y_points" value="100" min="1" max="200" step="1">
                        <span class="parameter-description" data-i18n="y_range_description">二维分布时有效，y_min=y_max表示一维，y范围0~100，分辨率1~200</span>
                    </div>
                </div>
                
                <div id="enhanced-dill-params" class="parameters-grid" style="display:none;">
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label"><span class="parameter-name">胶厚 (z_h, μm)</span><span class="parameter-value">10</span></div>
                        <div class="parameter-input"><input type="range" id="z_h" class="slider" min="1" max="50" step="0.1" value="10"><input type="number" class="number-input" value="10" min="1" max="50" step="0.1"></div>
                        <div class="parameter-description" data-i18n="param_desc_z_h">光刻胶厚度，单位：μm</div>
                    </div>
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label"><span class="parameter-name">前烘温度 (T, ℃)</span><span class="parameter-value">100</span></div>
                        <div class="parameter-input"><input type="range" id="T" class="slider" min="60" max="150" step="1" value="100"><input type="number" class="number-input" value="100" min="60" max="150" step="1"></div>
                        <div class="parameter-description" data-i18n="param_desc_T">前烘温度，单位：℃</div>
                    </div>
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label"><span class="parameter-name">前烘时间 (t_B, min)</span><span class="parameter-value">10</span></div>
                        <div class="parameter-input"><input type="range" id="t_B" class="slider" min="1" max="60" step="1" value="10"><input type="number" class="number-input" value="10" min="1" max="60" step="1"></div>
                        <div class="parameter-description" data-i18n="param_desc_t_B">前烘时间，单位：分钟</div>
                    </div>
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label"><span class="parameter-name">初始光强 (I0)</span><span class="parameter-value">1.0</span></div>
                        <div class="parameter-input"><input type="range" id="I0" class="slider" min="0.1" max="2" step="0.01" value="1.0"><input type="number" class="number-input" value="1.0" min="0.1" max="2" step="0.01"></div>
                        <div class="parameter-description" data-i18n="param_desc_I0">归一化初始光强</div>
                    </div>
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label"><span class="parameter-name">初始PAC浓度 (M0)</span><span class="parameter-value">1.0</span></div>
                        <div class="parameter-input"><input type="range" id="M0" class="slider" min="0.1" max="1.0" step="0.01" value="1.0"><input type="number" class="number-input" value="1.0" min="0.1" max="1.0" step="0.01"></div>
                        <div class="parameter-description" data-i18n="param_desc_M0">归一化初始PAC浓度</div>
                    </div>
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label"><span class="parameter-name">曝光时间 (t_exp, s)</span><span class="parameter-value">5</span></div>
                        <div class="parameter-input"><input type="range" id="t_exp_enhanced" class="slider" min="0.1" max="60" step="0.1" value="5"><input type="number" class="number-input" value="5" min="0.1" max="60" step="0.1"></div>
                        <div class="parameter-description" data-i18n="param_desc_t_exp_enhanced">曝光时间，单位：秒</div>
                    </div>

                    <!-- 在增强Dill参数区顶部插入正弦波类型选择和多维参数输入区 -->
                    <div class="parameter-item" id="enhanced-dill-sine-type-container">
                        <label for="enhanced-dill-sine-type" data-i18n="sine_wave_type_label">正弦波类型：</label>
                        <select id="enhanced-dill-sine-type" class="model-select">
                            <option value="single" selected data-i18n="sine_wave_type_single">一维正弦波</option>
                            <option value="multi" data-i18n="sine_wave_type_multi">二维正弦波</option>
                        </select>
                    </div>
                    <div id="enhanced-dill-multisine-params" style="display:none;">
                        <div class="parameter-item slider-fill">
                            <div class="parameter-label"><span class="parameter-name" data-i18n="kx_label">Kx (空间频率x)</span></div>
                            <div class="parameter-input"><input type="number" id="enhanced_Kx" value="2" min="0.1" max="10" step="0.1"></div>
                            <div class="parameter-description" data-i18n="kx_description">x方向空间频率，单位：rad/μm，范围：0.1~10</div>
                        </div>
                        <div class="parameter-item slider-fill">
                            <div class="parameter-label"><span class="parameter-name" data-i18n="ky_label">Ky (空间频率y)</span></div>
                            <div class="parameter-input"><input type="number" id="enhanced_Ky" value="1" min="0.1" max="100" step="0.1"></div>
                            <div class="parameter-description" data-i18n="ky_description">y方向空间频率，单位：rad/μm，范围：0.1~100（必须大于0）</div>
                        </div>
                        <div class="parameter-item slider-fill">
                            <div class="parameter-label"><span class="parameter-name" data-i18n="phi_label">φ(t) (相位表达式)</span></div>
                            <div class="parameter-input"><input type="text" id="enhanced_phi_expr" value="0"></div>
                            <div class="phi-expr-error" style="color:#d00;font-size:0.95em;display:none;"></div>
                            <button id="phi-expr-preview-btn" style="margin-top:4px;display:none;">预览分布</button>
                            <div id="phi-expr-preview-plot" style="margin-top:8px;display:none;"></div>
                        </div>
                    </div>
                </div>
                
                <div id="car-params" class="car-params parameters-grid" style="display:none;">
                    <!-- 参数1: I_avg -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">平均入射光强度 (I<sub>avg</sub>)</span>
                            
                            <span class="parameter-value">10</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="car_I_avg" class="slider" min="1" max="100" step="0.1" value="10">
                            <input type="number" class="number-input" value="10" min="1" max="100" step="0.1">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_car_I_avg">平均入射光强度，单位：mW/cm²</div>
                    </div>
                    
                    <!-- 参数2: V -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">干涉条纹可见度 (V)</span>
                            
                            <span class="parameter-value">0.8</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="car_V" class="slider" min="0" max="1" step="0.01" value="0.8">
                            <input type="number" class="number-input" value="0.8" min="0" max="1" step="0.01">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_car_V">干涉条纹的对比度，范围：0-1</div>
                    </div>
                    
                    <!-- 参数3: K -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">空间频率 (K)</span>
                            
                            <span class="parameter-value">2</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="car_K" class="slider" min="0.1" max="10" step="0.1" value="2">
                            <input type="number" class="number-input" value="2" min="0.1" max="10" step="0.1">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_car_K">干涉条纹的空间频率，单位：rad/μm</div>
                    </div>
                    
                    <!-- 参数4: t_exp -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">曝光时间 (t<sub>exp</sub>)</span>
                            
                            <span class="parameter-value">5</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="car_t_exp" class="slider" min="0.1" max="20" step="0.1" value="5">
                            <input type="number" class="number-input" value="5" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_car_t_exp">总曝光时间，单位：秒</div>
                    </div>
                    
                    <!-- 参数5: acid_gen_efficiency -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">光酸产生效率 (η)</span>
                            
                            <span class="parameter-value">0.5</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="car_acid_gen_efficiency" class="slider" min="0.01" max="1" step="0.01" value="0.5">
                            <input type="number" class="number-input" value="0.5" min="0.01" max="1" step="0.01">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_car_acid_gen">光子到光酸分子的转化效率，范围：0-1</div>
                    </div>
                    
                    <!-- 参数6: diffusion_length -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">扩散长度 (EPDL)</span>
                            
                            <span class="parameter-value">3</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="car_diffusion_length" class="slider" min="0" max="20" step="0.1" value="3">
                            <input type="number" class="number-input" value="3" min="0" max="20" step="0.1">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_car_diff">光酸扩散长度，单位：像素</div>
                    </div>
                    
                    <!-- 参数7: reaction_rate -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">反应速率常数 (k)</span>
                            
                            <span class="parameter-value">0.3</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="car_reaction_rate" class="slider" min="0.01" max="1" step="0.01" value="0.3">
                            <input type="number" class="number-input" value="0.3" min="0.01" max="1" step="0.01">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_car_rate">催化反应速率常数</div>
                    </div>
                    
                    <!-- 参数8: amplification -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">放大因子 (A)</span>
                            
                            <span class="parameter-value">10</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="car_amplification" class="slider" min="1" max="50" step="0.5" value="10">
                            <input type="number" class="number-input" value="10" min="1" max="50" step="0.5">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_car_amp">每个光酸分子可催化的反应数</div>
                    </div>
                    
                    <!-- 参数9: contrast -->
                    <div class="parameter-item slider-fill">
                        <div class="parameter-label">
                            <span class="parameter-name">对比度因子 (γ)</span>
                            
                            <span class="parameter-value">3</span>
                        </div>
                        <div class="parameter-input">
                            <input type="range" id="car_contrast" class="slider" min="0.1" max="10" step="0.1" value="3">
                            <input type="number" class="number-input" value="3" min="0.1" max="10" step="0.1">
                        </div>
                        <div class="parameter-description" data-i18n="param_desc_car_contrast">显影过程的对比度系数</div>
                    </div>

                    <!-- 在CAR参数区顶部插入正弦波类型选择和多维参数输入区 -->
                    <div class="parameter-item" id="car-sine-type-container">
                        <label for="car-sine-type" data-i18n="sine_wave_type_label">正弦波类型：</label>
                        <select id="car-sine-type" class="model-select">
                            <option value="single" selected data-i18n="sine_wave_type_single">一维正弦波</option>
                            <option value="multi" data-i18n="sine_wave_type_multi">二维正弦波</option>
                        </select>
                    </div>
                    <div id="car-multisine-params" style="display:none;">
                        <div class="parameter-item slider-fill">
                            <div class="parameter-label"><span class="parameter-name" data-i18n="kx_label">Kx (空间频率x)</span></div>
                            <div class="parameter-input"><input type="number" id="car_Kx" value="2" min="0.1" max="10" step="0.1"></div>
                            <div class="parameter-description" data-i18n="kx_description">x方向空间频率，单位：rad/μm，范围：0.1~10</div>
                        </div>
                        <div class="parameter-item slider-fill">
                            <div class="parameter-label"><span class="parameter-name" data-i18n="ky_label">Ky (空间频率y)</span></div>
                            <div class="parameter-input"><input type="number" id="car_Ky" value="1" min="0.1" max="100" step="0.1"></div>
                            <div class="parameter-description" data-i18n="ky_description">y方向空间频率，单位：rad/μm，范围：0.1~100（必须大于0）</div>
                        </div>
                        <div class="parameter-item slider-fill">
                            <div class="parameter-label"><span class="parameter-name" data-i18n="phi_label">φ(t) (相位表达式)</span></div>
                            <div class="parameter-input"><input type="text" id="car_phi_expr" value="0"></div>
                            <div class="phi-expr-error" style="color:#d00;font-size:0.95em;display:none;"></div>
                            <button id="phi-expr-preview-btn" style="margin-top:4px;display:none;">预览分布</button>
                            <div id="phi-expr-preview-plot" style="margin-top:8px;display:none;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="button-container">
                    <button id="calculate-btn" class="calculate-btn" data-i18n="calculate">计算</button>
                </div>
            </section>
            
            <!-- 结果展示区域 -->
            <section id="results-section" class="results-section">
                <h2 class="section-title" data-i18n="result_section">计算结果</h2>
                
                <div class="plots-container">
                    <!-- 曝光剂量分布图 -->
                    <div class="plot-item">
                        <h3 class="plot-title" data-i18n="exposure_dist">曝光剂量分布</h3>
                        <div id="exposure-plot-container" class="plot-container"></div>
                        <div class="plot-export-btns">
                            <button id="export-exposure-img" data-i18n="export_img">导出图片</button>
                            <button id="export-exposure-data" data-i18n="export_data">导出数据</button>
                        </div>
                        <!-- 保留原有图像作为后备 -->
                        <img id="exposure-plot" class="plot-image" style="display: none;" src="" alt="曝光剂量分布图">
                    </div>
                    
                    <!-- 光刻胶厚度分布图 -->
                    <div class="plot-item">
                        <h3 class="plot-title" data-i18n="thickness_dist">光刻胶厚度分布</h3>
                        <div id="thickness-plot-container" class="plot-container"></div>
                        <div class="plot-export-btns">
                            <button id="export-thickness-img" data-i18n="export_img">导出图片</button>
                            <button id="export-thickness-data" data-i18n="export_data">导出数据</button>
                        </div>
                        <!-- 保留原有图像作为后备 -->
                        <img id="thickness-plot" class="plot-image" style="display: none;" src="" alt="光刻胶厚度分布图">
                    </div>

                    <!-- 结果区增加二维热力图展示区域 -->
                    <div class="plot-item" id="heatmap-plot-item" style="display:none;">
                        <h3 class="plot-title" data-i18n="heatmap_plot_title">二维分布热力图</h3>
                        <div id="heatmap-plot-container" class="plot-container"></div>
                        <button id="export-heatmap-data" data-i18n="export_heatmap_data_btn">导出二维数据</button>
                    </div>
                </div>

                <!-- CAR模型交互式图表区域 -->
                <div id="car-interactive-plots" class="car-results-container" style="display: none;"></div>
                <div id="car-results" class="car-results-container" style="display: none;"></div>
            </section>
        </div>
    </main>
    
    <!-- 页脚 -->
    <footer>
        <div class="footer-content">
            <p>&copy; 2025 香港大学 版权所有.</p>
        </div>
    </footer>
    
    <!-- 引入JavaScript文件 -->
    <script src="js/common.js?v=1.0"></script>
    <script src="js/lang.js"></script>
    <script src="js/main.js"></script>
    <script src="js/car-model.js?v=1.0"></script>
    <script>
    // 模型切换逻辑
    const modelSelect = document.getElementById('model-select');
    const dillDesc = document.getElementById('dill-desc');
    const enhancedDillDesc = document.getElementById('enhanced-dill-desc');
    const carDesc = document.getElementById('car-desc');
    const dillParams = document.getElementById('dill-params');
    const enhancedDillParams = document.getElementById('enhanced-dill-params');
    const carParams = document.getElementById('car-params');
    const carInteractivePlots = document.getElementById('car-interactive-plots');
    const carResults = document.getElementById('car-results');
    
    modelSelect.addEventListener('change', function() {
        if (this.value === 'dill') {
            dillDesc.style.display = 'block';
            enhancedDillDesc.style.display = 'none';
            carDesc.style.display = 'none';
            dillParams.style.display = 'block';
            enhancedDillParams.style.display = 'none';
            carParams.style.display = 'none';
            carInteractivePlots.style.display = 'none';
            carResults.style.display = 'none';
        } else if (this.value === 'enhanced_dill') {
            dillDesc.style.display = 'none';
            enhancedDillDesc.style.display = 'block';
            carDesc.style.display = 'none';
            dillParams.style.display = 'none';
            enhancedDillParams.style.display = 'block';
            carParams.style.display = 'none';
            carInteractivePlots.style.display = 'none';
            carResults.style.display = 'none';
        } else if (this.value === 'car') {
            dillDesc.style.display = 'none';
            enhancedDillDesc.style.display = 'none';
            carDesc.style.display = 'block';
            dillParams.style.display = 'none';
            enhancedDillParams.style.display = 'none';
            carParams.style.display = 'block';
            carInteractivePlots.style.display = 'block';
            carResults.style.display = 'block';
        }
    });
    
    // 展开更多详情按钮事件
    const dillToggleBtn = document.getElementById('dill-toggle-details');
    const enhancedDillToggleBtn = document.getElementById('enhanced-dill-toggle-details');
    const carToggleBtn = document.getElementById('car-toggle-details');
    const dillFullDetails = document.getElementById('dill-full-details');
    const enhancedDillFullDetails = document.getElementById('enhanced-dill-full-details');
    const carFullDetails = document.getElementById('car-full-details');
    
    dillToggleBtn.addEventListener('click', function() {
        const isVisible = dillFullDetails.classList.contains('details-visible');
        if (isVisible) {
            dillFullDetails.classList.remove('details-visible');
            this.innerHTML = LANGS[currentLang].btn_expand;
        } else {
            dillFullDetails.classList.add('details-visible');
            this.innerHTML = LANGS[currentLang].btn_collapse;
        }
    });
    
    enhancedDillToggleBtn.addEventListener('click', function() {
        const isVisible = enhancedDillFullDetails.classList.contains('details-visible');
        if (isVisible) {
            enhancedDillFullDetails.classList.remove('details-visible');
            this.innerHTML = LANGS[currentLang].btn_expand;
        } else {
            enhancedDillFullDetails.classList.add('details-visible');
            this.innerHTML = LANGS[currentLang].btn_collapse;
        }
    });
    
    carToggleBtn.addEventListener('click', function() {
        const isVisible = carFullDetails.classList.contains('details-visible');
        if (isVisible) {
            carFullDetails.classList.remove('details-visible');
            this.innerHTML = LANGS[currentLang].btn_expand;
        } else {
            carFullDetails.classList.add('details-visible');
            this.innerHTML = LANGS[currentLang].btn_collapse;
        }
    });

    // 计算按钮事件，传递model_type参数
    const calculateBtn = document.getElementById('calculate-btn');
    calculateBtn.addEventListener('click', function() {
        let modelType = modelSelect.value;
        let postData = { model_type: modelType };
        
        // 通用参数：y范围，对所有模型和类型都适用
        postData['y_min'] = parseFloat(document.getElementById('y_min').value);
        postData['y_max'] = parseFloat(document.getElementById('y_max').value);
        postData['y_points'] = parseInt(document.getElementById('y_points').value);

        if (modelType === 'dill') {
            postData['I_avg'] = parseFloat(document.getElementById('I_avg').value);
            postData['V'] = parseFloat(document.getElementById('V').value);
            postData['t_exp'] = parseFloat(document.getElementById('t_exp').value);
            postData['C'] = parseFloat(document.getElementById('C').value);

            const sineType = document.getElementById('dill-sine-type').value;
            postData['sine_type'] = sineType;
            if (sineType === 'multi') {
                postData['Kx'] = parseFloat(document.getElementById('Kx').value);
                postData['Ky'] = parseFloat(document.getElementById('Ky').value);
                postData['phi_expr'] = document.getElementById('phi_expr').value;
            } else { // 'single' or other defaults to 1D
                postData['K'] = parseFloat(document.getElementById('K').value);
            }
        } else if (modelType === 'enhanced_dill') {
            postData['z_h'] = parseFloat(document.getElementById('z_h').value);
            postData['T'] = parseFloat(document.getElementById('T').value);
            postData['t_B'] = parseFloat(document.getElementById('t_B').value);
            postData['I0'] = parseFloat(document.getElementById('I0').value);
            postData['M0'] = parseFloat(document.getElementById('M0').value);
            postData['t_exp'] = parseFloat(document.getElementById('t_exp_enhanced').value);

            const sineType = document.getElementById('enhanced-dill-sine-type').value;
            postData['sine_type'] = sineType;
            if (sineType === 'multi') {
                postData['Kx'] = parseFloat(document.getElementById('enhanced_Kx').value);
                postData['Ky'] = parseFloat(document.getElementById('enhanced_Ky').value);
                postData['phi_expr'] = document.getElementById('enhanced_phi_expr').value;
            } else { // For enhanced_dill, if 1D, it might not use a global K, check model.
                // Assuming it might also need a K if 1D, or backend handles K if sine_type is not multi.
                // If enhanced_dill 1D doesn't use K, this K part can be omitted.
                // For now, let's assume K might be relevant if not multi, or backend ignores if not needed.
                // postData['K'] = ...; // Add if relevant for 1D enhanced Dill
            }
        } else if (modelType === 'car') {
            postData['I_avg'] = parseFloat(document.getElementById('car_I_avg').value);
            postData['V'] = parseFloat(document.getElementById('car_V').value);
            postData['t_exp'] = parseFloat(document.getElementById('car_t_exp').value);
            postData['acid_gen_efficiency'] = parseFloat(document.getElementById('car_acid_gen_efficiency').value);
            postData['diffusion_length'] = parseFloat(document.getElementById('car_diffusion_length').value);
            postData['reaction_rate'] = parseFloat(document.getElementById('car_reaction_rate').value);
            postData['amplification'] = parseFloat(document.getElementById('car_amplification').value);
            postData['contrast'] = parseFloat(document.getElementById('car_contrast').value);

            const sineType = document.getElementById('car-sine-type').value;
            postData['sine_type'] = sineType;
            if (sineType === 'multi') {
                postData['Kx'] = parseFloat(document.getElementById('car_Kx').value);
                postData['Ky'] = parseFloat(document.getElementById('car_Ky').value);
                postData['phi_expr'] = document.getElementById('car_phi_expr').value;
            } else { // 'single' or other defaults to 1D
                postData['K'] = parseFloat(document.getElementById('car_K').value);
            }
        }
        
        // 显示加载动画
        document.getElementById('loading').style.display = 'flex';
        
        // 发起POST请求
        fetch('/api/calculate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(postData)
        })
        .then(response => response.json())
        .then(data => {
            // 隐藏加载动画
            document.getElementById('loading').style.display = 'none';
            
            if (data.success) {
                if (modelType === 'car') {
                    // 显示CAR模型结果
                    displayCarResults(data.data);
                } else {
                    // 显示普通模型结果
                    document.getElementById('exposure-plot').src = 'data:image/png;base64,' + data.data.exposure_plot;
                    document.getElementById('thickness-plot').src = 'data:image/png;base64,' + data.data.thickness_plot;
                }
            } else {
                showErrorMessage(data.message);
            }
        })
        .catch(error => {
            document.getElementById('loading').style.display = 'none';
            showErrorMessage('请求失败: ' + error.message);
        });
        
        // 同时请求交互式数据
        fetch('/api/calculate_data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(postData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                if (modelType === 'car') {
                    renderCarInteractivePlots(data.data);
                } else {
                    // 处理其他模型的交互式数据
                    // ...原有代码...
                }
            }
        })
        .catch(error => {
            console.error('获取交互式数据失败:', error);
        });
    });
    </script>
</body>
</html> 